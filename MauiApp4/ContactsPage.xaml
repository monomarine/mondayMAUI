<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiApp4.ContactsPage"
             xmlns:vm="clr-namespace:MauiApp4.ViewModel"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             BackgroundColor="#F0F4F8">

    <ContentPage.BindingContext>
        <vm:ContactsViewModel/>
    </ContentPage.BindingContext>

    <ContentPage.Resources>
        <ResourceDictionary>

            <DataTemplate x:Key="ContactItem">
                <Frame Padding="10" Margin="5" CornerRadius="8" BorderColor="#CCCCCC" BackgroundColor="White" HasShadow="True">
                    <VerticalStackLayout>
                        <Label Text="{Binding FirstName}" FontAttributes="Bold" TextColor="#007ACC"/>
                        <Label Text="{Binding LastName}" TextColor="#333333"/>
                        <Label Text="{Binding Phone}" TextColor="#28A745"/>
                        <Label Text="{Binding Email}" TextColor="#6C63FF"/>
                        <HorizontalStackLayout Spacing="10" Margin="0,5,0,0">
                            <Button Text="Редактировать"
                                    BackgroundColor="#FFC107"
                                    TextColor="#333333"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ContactsViewModel}}, Path=EditContactCommand}"
                                    CommandParameter="{Binding .}"/>
                            <Button Text="Удалить"
                                    BackgroundColor="#DC3545"
                                    TextColor="White"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ContactsViewModel}}, Path=DeleteContactCommand}"
                                    CommandParameter="{Binding .}"/>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Frame>
            </DataTemplate>

            <Label x:Key="EmptyContact" Text="Контактов нет" HorizontalOptions="Center" VerticalOptions="Center" TextColor="#555555"/>

        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="10">

        <VerticalStackLayout Spacing="10">

            <Label Text="СПИСОК КОНТАКТОВ"
                   FontSize="26"
                   HorizontalOptions="Center"
                   FontAttributes="Bold"
                   TextColor="#007ACC"/>

            <Button Text="Добавить контакт"
                    Command="{Binding AddContactCommand}"
                    HorizontalOptions="Fill"
                    BackgroundColor="#28A745"
                    TextColor="White"
                    CornerRadius="8"/>

            <SearchBar Placeholder="Поиск..." 
                       Text="{Binding SearchText}"
                       SearchCommand="{Binding RefreshContactsCommand}"
                       BackgroundColor="White"
                       TextColor="#333333"
                       PlaceholderColor="#999999"/>

            <CollectionView ItemsSource="{Binding Contacts}"
                            ItemTemplate="{StaticResource ContactItem}"
                            EmptyView="{StaticResource EmptyContact}"
                            SelectionMode="None"/>

        </VerticalStackLayout>

        <!-- Модальное окно -->
        <Border x:Name="ModalOverlay"
                IsVisible="{Binding IsModalVisible}"
                BackgroundColor="#80000000"
                HorizontalOptions="Fill"
                VerticalOptions="Fill">

            <VerticalStackLayout HorizontalOptions="Center" 
                                 VerticalOptions="Center"
                                 WidthRequest="300"
                                 BackgroundColor="#FFFFFF"
                                 Spacing="10"
                                 Padding="20">

                <Label Text="{Binding ModalTitle}"  
                       FontSize="Large"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center"
                       FontAttributes="Bold"
                       TextColor="#007ACC"/>

                <Entry Margin="0,5,0,5" Placeholder="Имя" Text="{Binding EditingContact.FirstName}" TextColor="#333333" PlaceholderColor="#999999"/>
                <Entry Margin="0,5,0,5" Placeholder="Фамилия" Text="{Binding EditingContact.LastName}" TextColor="#333333" PlaceholderColor="#999999"/>
                <Entry Margin="0,5,0,5" Placeholder="Телефон" Text="{Binding EditingContact.Phone}" Keyboard="Telephone" TextColor="#333333" PlaceholderColor="#999999"/>
                <Entry Margin="0,5,0,5" Placeholder="Email" Text="{Binding EditingContact.Email}" Keyboard="Email" TextColor="#333333" PlaceholderColor="#999999"/>
                <Entry Margin="0,5,0,5" Placeholder="Адрес" Text="{Binding EditingContact.Address}" TextColor="#333333" PlaceholderColor="#999999"/>

                <Grid ColumnDefinitions="*,*" ColumnSpacing="10" Padding="10">
                    <Button Grid.Column="0" Text="Отмена" Command="{Binding CloseModalCommand}" BackgroundColor="#6C757D" TextColor="White"/>
                    <Button Grid.Column="1" Text="Сохранить" Command="{Binding SaveContactCommand}" BackgroundColor="#007ACC" TextColor="White"/>
                </Grid>

            </VerticalStackLayout>
        </Border>

    </Grid>
</ContentPage>
