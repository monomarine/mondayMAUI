<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiApp4.ContactsPage"
             xmlns:vm="clr-namespace:MauiApp4.ViewModel"
             Title="ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹"
             BackgroundColor="#F5F5F5">
    <Grid>

        <ScrollView>
            <VerticalStackLayout Margin="15, 20">

                <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10" Margin="0,0,0,20">
                    <SearchBar Grid.Column="0" 
                             Text="{Binding SearchText}"
                             SearchCommand="{Binding SearchContactCommand}"
                             Placeholder="ÐŸÐ¾Ð¸ÑÐº ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¾Ð²..."/>

                    <Button Grid.Column="1"
                            Text="ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"
                            Command="{Binding RefreshContactsCommand}"
                            BackgroundColor="#007ACC"
                            TextColor="White"
                            CornerRadius="8"
                            WidthRequest="100"/>

                    <Button Grid.Column="2"
                            Text="+"
                            Command="{Binding AddContactCommand}"
                            BackgroundColor="#007ACC"
                            TextColor="White"
                            CornerRadius="8"
                            WidthRequest="50"
                            FontSize="20"/>
                </Grid>

                <Label Text="Ð¡ÐŸÐ˜Ð¡ÐžÐš ÐšÐžÐÐ¢ÐÐšÐ¢ÐžÐ’" 
                       HorizontalOptions="Center"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="#333333"
                       Margin="0,0,0,10"/>

                <ActivityIndicator IsRunning="{Binding IsBusy}" 
                                 IsVisible="{Binding IsBusy}"
                                 HorizontalOptions="Center"
                                 Color="#007ACC"
                                 HeightRequest="50"
                                 WidthRequest="50"/>

                <CollectionView ItemsSource="{Binding Contacts}"
                                SelectedItem="{Binding SelectedContact}"
                                SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Padding="10" Margin="0, 5" CornerRadius="8" BackgroundColor="White" HasShadow="True">
                                <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto,Auto"
                                      RowSpacing="5">

                                    <Label Grid.Column="0" Grid.Row="0" Grid.RowSpan="2"
                                           Text="ðŸ™ðŸ»â€â™‚ï¸"
                                           FontSize="30"
                                           VerticalOptions="Start"
                                           Margin="0,0,15,0"/>

                                    <Label Grid.Column="1" Grid.Row="0"
                                           Text="{Binding FullName}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="#333333"/>

                                    <Label Grid.Column="1" Grid.Row="1"
                                           Text="{Binding Phone}"
                                           FontSize="14"
                                           TextColor="#007ACC"/>

                                    <Label Grid.Column="1" Grid.Row="2"
                                           Text="{Binding Email}"
                                           FontSize="12"
                                           TextColor="Gray"/>

                                    <HorizontalStackLayout Grid.Column="2" Grid.Row="0" Grid.RowSpan="3" Spacing="5" 
                                                           VerticalOptions="Center" HorizontalOptions="End">

                                        <Button Text="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ContactsViewModel}}, Path=EditContactCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="#007ACC"
                                                TextColor="White"
                                                CornerRadius="5"
                                                FontSize="12"
                                                Padding="10, 5"/>

                                        <Button Text="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ContactsViewModel}}, Path=DeleteContactCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="#DC3545"
                                                TextColor="White"
                                                CornerRadius="5"
                                                FontSize="12"
                                                Padding="10, 5"/>
                                    </HorizontalStackLayout>

                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                    <CollectionView.EmptyView>
                        <StackLayout HorizontalOptions="Center" VerticalOptions="Center" Padding="40" Margin="0, 50, 0, 0">
                            <Label Text="ÐÐµÑ‚ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¾Ð²"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"/>
                            <Label Text="ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ + Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚"
                                   FontSize="14"
                                   HorizontalOptions="Center"
                                   TextColor="Gray"/>
                        </StackLayout>
                    </CollectionView.EmptyView>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

        <Grid IsVisible="{Binding IsModalVisible}"
              BackgroundColor="#99000000" HorizontalOptions="Fill"
              VerticalOptions="Fill">

            <Frame HorizontalOptions="Center" 
                   VerticalOptions="Center"
                   WidthRequest="350"
                   Padding="20"
                   CornerRadius="10"
                   BackgroundColor="White">

                <VerticalStackLayout Spacing="15">
                    <Label Text="{Binding EditingContact.Id, StringFormat='{0:Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚ #0;ÐÐ¾Ð²Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚}'}" 
                           FontSize="18"
                           HorizontalOptions="Center"
                           FontAttributes="Bold"
                           TextColor="#333333"/>

                    <VerticalStackLayout Spacing="10">
                        <Entry Text="{Binding EditingContact.FirstName}"
                               Placeholder="Ð˜Ð¼Ñ *"
                               PlaceholderColor="Gray"/>

                        <Entry Text="{Binding EditingContact.LastName}"
                               Placeholder="Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ *"
                               PlaceholderColor="Gray"/>

                        <Entry Text="{Binding EditingContact.Phone}"
                               Placeholder="Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½ *"
                               PlaceholderColor="Gray"
                               Keyboard="Telephone"/>

                        <Entry Text="{Binding EditingContact.Email}"
                               Placeholder="Email *"
                               PlaceholderColor="Gray"
                               Keyboard="Email"/>

                        <Entry Text="{Binding EditingContact.Address}"
                               Placeholder="ÐÐ´Ñ€ÐµÑ"
                               PlaceholderColor="Gray"/>
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Button Grid.Column="0" 
                                Text="ÐžÑ‚Ð¼ÐµÐ½Ð°" 
                                Command="{Binding CloseModalCommand}"
                                BackgroundColor="#CCCCCC"
                                TextColor="#333333"
                                CornerRadius="8"/>

                        <Button Grid.Column="1" 
                                Text="Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ" 
                                Command="{Binding SaveContactCommand}"
                                BackgroundColor="#007ACC"
                                TextColor="White"
                                CornerRadius="8"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>